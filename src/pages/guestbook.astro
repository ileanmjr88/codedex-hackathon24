---
import Layout from "../layout/Layout.astro";

const response = await fetch('/api/guestbook');
const guestbook = await response.json();
---

<Layout title="Guestbook">
   
    <form id="guestbook-form">
      <label for="name">Name:</label>
      <input type="text" id="name" name="name" required />
    
      <label for="message">Message:</label>
      <textarea id="message" name="message" required></textarea>
    
      <button type="submit">Sign Guestbook</button>
    </form>
    
    <script>
      document.querySelector('#guestbook-form').addEventListener('submit', async (event) => {
        event.preventDefault();
    
        const formData = new FormData(event.target);
        const response = await fetch('/api/guestbook', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            name: formData.get('name'),
            message: formData.get('message'),
          }),
        });
    
        if (response.ok) {
          alert('Thank you for signing the guestbook!');
          location.reload();
        } else {
          alert('Something went wrong. Please try again.');
        }
      });
    </script>
    
    <h2>Guestbook Entries</h2>
    <ul>
      {entries.map((entry) => (
        <li>
          <strong>{entry.name}</strong> ({new Date(entry.createdAt).toLocaleString()}): {entry.message}
        </li>
      ))}
    </ul>
    
</Layout>